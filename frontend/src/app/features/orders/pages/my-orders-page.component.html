<section class="orders-page">
  <app-store-header [searchValue]="''" [showSearchAction]="false" [showCustomerMenu]="true" />

  <div class="orders-container">
    <header class="page-header">
      <h1>Pedidos</h1>
      <p>Acompanhe seus pedidos e veja o status das entregas.</p>
    </header>

    @if (myOrdersFacade.successMessage()) {
      <div class="state-card state-card--success" role="status">
        {{ myOrdersFacade.successMessage() }}
      </div>
    }

    @if (myOrdersFacade.loading()) {
      <div class="state-card" role="status">Carregando suas compras...</div>
    } @else if (myOrdersFacade.error()) {
      <div class="state-card state-card--error" role="alert">{{ myOrdersFacade.error() }}</div>
    } @else if (myOrdersFacade.orders().length === 0) {
      <div class="state-card" role="status">
        <p>Você ainda não possui pedidos.</p>
        <a routerLink="/">Explorar catálogo</a>
      </div>
    } @else {
      <div class="orders-grid" aria-label="Lista de pedidos">
        @for (order of myOrdersFacade.orders(); track order.id) {
          <article class="order-card">
            <div class="order-card__status">
              <span
                class="status-badge"
                [class]="'status-badge status-badge--' + myOrdersFacade.getStatusClass(order.status)"
              >
                {{ myOrdersFacade.getStatusLabel(order.status) }}
              </span>
              <span class="order-date">{{ formatDate(order.createdAt) }}</span>
            </div>

            <img
              src="https://placehold.co/500x520/f5f5f5/9f9f9f?text=Pedido"
              alt="Pedido {{ order.id }}"
            />

            <div class="order-card__content">
              <p><strong>{{ order.itemsCount }} itens</strong></p>
              <p>Pedido {{ order.id }}</p>
              <p class="order-total">{{ formatCurrency(order.totalAmountCents) }}</p>
            </div>

            <div class="order-card__actions">
              <a [routerLink]="['/minhas-compras', order.id]">Ver detalhes</a>
              <button type="button" (click)="goToCatalog()">Comprar novamente</button>
            </div>
          </article>
        }
      </div>

      <nav class="pagination" aria-label="Paginação de pedidos">
        <button type="button" [disabled]="!canGoToPreviousPage()" (click)="goToPreviousPage()">
          Anterior
        </button>
        <span>
          Página {{ myOrdersFacade.paginationMeta().page }} de {{ myOrdersFacade.paginationMeta().totalPages }}
        </span>
        <button type="button" [disabled]="!canGoToNextPage()" (click)="goToNextPage()">Próxima</button>
      </nav>
    }
  </div>
</section>
