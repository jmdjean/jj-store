<section class="cart-page">
  <app-store-header [searchValue]="''" [showSearchAction]="false" />

  <header class="page-header">
    <h1>Seu carrinho</h1>
    <p>Revise os itens antes de seguir para o checkout.</p>
  </header>

  @if (cartFacade.cartFeedback()) {
    <div class="state-card" role="status">{{ cartFacade.cartFeedback() }}</div>
  }

  @if (!cartFacade.hasItems()) {
    <div class="state-card">
      <p>Seu carrinho está vazio.</p>
      <button type="button" (click)="goToCatalog()">Continuar comprando</button>
    </div>
  } @else {
    <div class="cart-layout">
      <ul class="cart-items">
        @for (item of cartFacade.items(); track item.id) {
          <li>
            <img
              [src]="item.imageUrl || 'https://placehold.co/240x180/f8efe5/8e6e4f?text=Sem+Imagem'"
              [alt]="item.name"
            />

            <div class="item-content">
              <div class="item-header">
                <h2>{{ item.name }}</h2>
                <span class="item-price">{{ formatPrice(item.price) }}</span>
              </div>
              <p class="item-meta">Preço unitário • {{ formatPrice(item.price) }}</p>

              <div class="item-actions">
                <div class="quantity-stepper" aria-label="Quantidade">
                  <button type="button" (click)="decreaseQuantity(item.id, item.quantity)">-</button>
                  <span>{{ item.quantity }}</span>
                  <button type="button" (click)="increaseQuantity(item.id, item.quantity)">+</button>
                </div>
                <div class="item-subtotal">
                  <span>Subtotal</span>
                  <strong>{{ formatPrice(item.price * item.quantity) }}</strong>
                </div>
                <button type="button" class="link-danger" (click)="removeItem(item.id)">Remover</button>
              </div>
            </div>
          </li>
        }
      </ul>

      <aside class="summary-card">
        <h3>Resumo</h3>
        <p>
          Itens <strong>{{ cartFacade.totalItems() }}</strong>
        </p>
        <p>
          Subtotal <strong>{{ formatPrice(cartFacade.subtotal()) }}</strong>
        </p>
        <p>
          Frete <strong>A calcular</strong>
        </p>
        <p class="summary-total">
          Total <strong>{{ formatPrice(cartFacade.subtotal()) }}</strong>
        </p>

        <button type="button" (click)="goToCheckout()">Finalizar compra</button>
        <div class="summary-trust">
          <span>Compra segura</span>
          <span>Pix e cartão</span>
          <span>Entrega rápida</span>
        </div>
      </aside>
    </div>
  }
</section>
